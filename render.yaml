# Render Blueprint - Engineering Metrics Dashboard
# https://render.com/docs/blueprint-spec
#
# IMPORTANT: Render Workflows are created via the Render Dashboard, not via this file.
# To deploy the workflow:
#   1. Go to Render Dashboard > New > Workflow
#   2. Link this repository
#   3. Set Build Command: pip install -r requirements.txt
#   4. Set Start Command: python main.py
#   5. Configure environment variables
#
# The cron jobs below are for triggering the workflow on a schedule.
# They use the Render API to run the `run_metrics_pipeline` task.

services:
  # Cron job to trigger weekly metrics workflow
  - type: cron
    name: trigger-weekly-metrics
    runtime: python
    schedule: "0 9 * * 1"  # Every Monday at 9 AM UTC
    buildCommand: pip install httpx python-dotenv
    startCommand: python scripts/trigger_workflow.py weekly
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: RENDER_API_KEY
        sync: false
      - key: WORKFLOW_SERVICE_ID
        sync: false

  # Cron job to trigger monthly metrics workflow
  - type: cron
    name: trigger-monthly-metrics
    runtime: python
    schedule: "0 9 1 * *"  # First day of each month at 9 AM UTC
    buildCommand: pip install httpx python-dotenv
    startCommand: python scripts/trigger_workflow.py monthly
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: RENDER_API_KEY
        sync: false
      - key: WORKFLOW_SERVICE_ID
        sync: false

# Environment variables needed for the Workflow service (set in Dashboard):
#
# Required:
#   - LINEAR_API_KEY: Linear API key
#   - GITHUB_TOKEN: GitHub personal access token
#   - GITHUB_ORG: GitHub organization name
#
# Optional:
#   - SLAB_API_TOKEN: Slab API token
#   - SLAB_TEAM_ID: Slab team ID
#   - SLACK_WEBHOOK_URL: Slack webhook for notifications
